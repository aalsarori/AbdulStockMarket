@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}


<head>

    <link rel="stylesheet" href="~/css/slider.css">
    <script src="~/js/draggable.js" defer></script>
    <script src="~/js/example.js" defer></script>
    <script src="https://cdn.anychart.com/releases/8.0.0/js/anychart-base.min.js"></script>
</head>

<div>
    <h1 class="display-4">BradRock, Inc.</h1>

    <br />

    <div id="final" style="display: none;">
        <div>Game Complete!</div>
        <div>Initial Cash: $10000</div>
        <div>Initial Investment: $0</div>
        <div id="finalamount">Total Change: $-</div>
        <div id="startdate">---</div>
    </div>

    <div id="date">---</div>
    <div id="cash">---</div>
    <div id="investment">---</div>
    <div id="ticker">---</div>

    <div id="dataholder">
        <div id="stocks">---</div>
        <div id="tickerprice">---</div>
    </div>

    <div style="display:none;" id="lastaction">Hidden</div>



    <div id="startdisplay">
        <br />

        @Html.AntiForgeryToken()
        <button type="button" id="invokeData">Choose Stock</button>
        <input type="text" id="tickerVariable" name="tickerName" value="AAPL" />
        <br />
        <br />
    </div>

    <div id="buttondisplay" style="display: none">


        @Html.AntiForgeryToken()
        <div id="choosescreen">
            <button type="button" id="goBuy">Buy</button>
            <br />
            <br />
            <button type="button" id="goSell">Sell</button>
            <br />
            <br />
        </div>

        @Html.AntiForgeryToken()
    <div id="buyscreen" style="display: none;">

        <div id="piechart-controls">
            <canvas id="piechart" width="200%" height="200%">
            </canvas>
            <div id="container" style="width: 50%; height: 50%"></div>
            <table id="proportions-table"></table>

        </div>


        <div class="slider">
            <input type="range" min="1" max="10000" value="50" name="mySlider" id="mySlider"
                   onchange="updateTextInput(this.value);" />

           
        </div>



        <input type="text" id="buyVariable" name="buyVariable" placeholder="Enter amount..." onchange="updateSliderInput(this.value);"/>
        <button type="button" id="invokeBuy">Buy</button>
        <br />
        <br />
    </div>

        @Html.AntiForgeryToken()
    <div id="sellscreen" style="display: none;">


        <div id="piechart-controls">
            <canvas id="piechart" width="200%" height="200%">
            </canvas>
            <div id="container2" style="width: 50%; height: 50%"></div>
            <table id="proportions-table"></table>

        </div>


        <div class="slider">
            <input type="range" min="1" max="10000" value="50" name="mySlider2" id="mySlider2"
                   onchange="updateTextInput1(this.value);" />


        </div>




        <input type="text" id="sellVariable" name="sellVariable" placeholder="Enter amount..." onchange="updateSliderInput1(this.value);" />
        <button type="button" id="invokeSell">Sell</button>
        <br />
        <br />
    </div>

        @Html.AntiForgeryToken()
        <button type="button" id="invokeHold">Hold</button>
        <br />
        <br />

        @Html.AntiForgeryToken()
        <button type="button" id="invokeQuit">Quit</button>
        <br />
        <br />

    </div>

</div>

<!--
    Do an On Change
    Make a hidden div
    When the field says done, make it so the buttons are disabled and it says Final Score at the top and shows them their finals
-->
@section Scripts
    {
    <script type="text/javascript">
        $("#invokeData").click(function() {
            var tickerChosen = $('#tickerVariable').val();

            $.ajax({
                type: "POST",
                url: "/Index?handler=SetTicker",
                data: { "name": tickerChosen },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(message) {
                    document.getElementById("buttondisplay").style.display = "block";
                    document.getElementById("ticker").innerHTML = message;
                    document.getElementById("choosescreen").style.display = "block";
                    document.getElementById("sellscreen").style.display = "none";
                    document.getElementById("buyscreen").style.display = "none";

                    $.ajax({
                        type: "POST",
                        url: "/Index?handler=GetDate",
                        data: { "name": " World!" },
                        contentType: 'application/x-www-form-urlencoded',
                        dataType: "json",
                        headers:
                        {
                            "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                        },
                        success: function(message) {
                            document.getElementById("date").innerHTML = message;
                            $.ajax({
                                type: "POST",
                                url: "/Index?handler=GetStocks",
                                data: { "name": " World!" },
                                contentType: 'application/x-www-form-urlencoded',
                                dataType: "json",
                                headers:
                                {
                                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                },
                                success: function(message) {
                                    document.getElementById("stocks").innerHTML = message;
                                    $.ajax({
                                        type: "POST",
                                        url: "/Index?handler=GetCash",
                                        data: { "name": " World!" },
                                        contentType: 'application/x-www-form-urlencoded',
                                        dataType: "json",
                                        headers:
                                        {
                                            "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                        },
                                        success: function(message) {
                                            document.getElementById("cash").innerHTML = message;
                                            $.ajax({
                                                type: "POST",
                                                url: "/Index?handler=GetInvestment",
                                                data: { "name": " World!" },
                                                contentType: 'application/x-www-form-urlencoded',
                                                dataType: "json",
                                                headers:
                                                {
                                                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                },
                                                success: function(message) {
                                                    document.getElementById("investment").innerHTML = message;
                                                    $.ajax({
                                                        type: "POST",
                                                        url: "/Index?handler=GetCurrentTickerPrice",
                                                        data: { "name": " World!" },
                                                        contentType: 'application/x-www-form-urlencoded',
                                                        dataType: "json",
                                                        headers:
                                                        {
                                                            "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                        },
                                                        success: function(message) {
                                                            document.getElementById("tickerprice").innerHTML = message;
                                                        }
                                                    });
                                                }
                                            });
                                        }
                                    });
                                }
                            });
                        }
                    });
                }
            });
        });

        $("#invokeBuy").click(function() {
            var amountMoney = $('#buyVariable').val();
            var tickerChosen = $('#tickerVariable').val();

            $.ajax({
                type: "POST",
                url: "/Index?handler=BuyStocks",
                data: { "amountBuy": amountMoney },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(message) {
                    // Do the logic here instead of in the .cs, return the ticker pricec though, and have global variables for Cash, Ticker, etc.. and actually return the name instead of the public variable in the .cs file
                    document.getElementById("lastaction").innerHTML = message;
                    // Call new function

                    document.getElementById("choosescreen").style.display = "block";
                    document.getElementById("sellscreen").style.display = "none";
                    document.getElementById("buyscreen").style.display = "none";

                    if (message == "COMPLETE") {
                        document.getElementById("buttondisplay").style.display = "none";
                        document.getElementById("dataholder").style.display = "none";
                        document.getElementById("final").style.display = "block";
                        document.getElementById("startdisplay").style.display = "none";
                    }
                }
            });

            setTimeout(wait(), 2000);
            // or put a timer here

            function wait() {
                // Make all this a function you can call
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=GetDate",
                    data: { "name": " World!" },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function(message) {
                        document.getElementById("date").innerHTML = message;
                        $.ajax({
                            type: "POST",
                            url: "/Index?handler=GetTicker",
                            data: { "name": tickerChosen },
                            contentType: 'application/x-www-form-urlencoded',
                            dataType: "json",
                            headers:
                            {
                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                            },
                            success: function(message) {
                                document.getElementById("ticker").innerHTML = message;
                                $.ajax({
                                    type: "POST",
                                    url: "/Index?handler=GetStocks",
                                    data: { "name": " World!" },
                                    contentType: 'application/x-www-form-urlencoded',
                                    dataType: "json",
                                    headers:
                                    {
                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                    },
                                    success: function(message) {
                                        document.getElementById("stocks").innerHTML = message;
                                        $.ajax({
                                            type: "POST",
                                            url: "/Index?handler=GetCash",
                                            data: { "name": " World!" },
                                            contentType: 'application/x-www-form-urlencoded',
                                            dataType: "json",
                                            headers:
                                            {
                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                            },
                                            success: function(message) {
                                                document.getElementById("cash").innerHTML = message;
                                                $.ajax({
                                                    type: "POST",
                                                    url: "/Index?handler=GetInvestment",
                                                    data: { "name": " World!" },
                                                    contentType: 'application/x-www-form-urlencoded',
                                                    dataType: "json",
                                                    headers:
                                                    {
                                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                    },
                                                    success: function(message) {
                                                        document.getElementById("investment").innerHTML = message;
                                                        $.ajax({
                                                            type: "POST",
                                                            url: "/Index?handler=GetCurrentTickerPrice",
                                                            data: { "name": " World!" },
                                                            contentType: 'application/x-www-form-urlencoded',
                                                            dataType: "json",
                                                            headers:
                                                            {
                                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                            },
                                                            success: function(message) {
                                                                document.getElementById("tickerprice").innerHTML = message;
                                                            }
                                                        });
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            }
        });

        $("#invokeSell").click(function() {
            var amountMoney = $('#sellVariable').val();
            var tickerChosen = $('#tickerVariable').val();

            $.ajax({
                type: "POST",
                url: "/Index?handler=SellStocks",
                data: { "amountSold": amountMoney },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(message) {
                    // Do the logic here instead of in the .cs, return the ticker pricec though, and have global variables for Cash, Ticker, etc.. and actually return the name instead of the public variable in the .cs file
                    document.getElementById("lastaction").innerHTML = message;
                    document.getElementById("choosescreen").style.display = "block";
                    document.getElementById("sellscreen").style.display = "none";
                    document.getElementById("buyscreen").style.display = "none";

                    if (message == "COMPLETE") {
                        document.getElementById("buttondisplay").style.display = "none";
                        document.getElementById("dataholder").style.display = "none";
                        document.getElementById("final").style.display = "block";
                        document.getElementById("startdisplay").style.display = "none";
                    }
                }
            });

            setTimeout(wait(), 2000);
            // or put a timer here

            function wait() {
                // Make all this a function you can call
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=GetDate",
                    data: { "name": " World!" },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function(message) {
                        document.getElementById("date").innerHTML = message;
                        $.ajax({
                            type: "POST",
                            url: "/Index?handler=GetTicker",
                            data: { "name": tickerChosen },
                            contentType: 'application/x-www-form-urlencoded',
                            dataType: "json",
                            headers:
                            {
                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                            },
                            success: function(message) {
                                document.getElementById("ticker").innerHTML = message;
                                $.ajax({
                                    type: "POST",
                                    url: "/Index?handler=GetStocks",
                                    data: { "name": " World!" },
                                    contentType: 'application/x-www-form-urlencoded',
                                    dataType: "json",
                                    headers:
                                    {
                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                    },
                                    success: function(message) {
                                        document.getElementById("stocks").innerHTML = message;
                                        $.ajax({
                                            type: "POST",
                                            url: "/Index?handler=GetCash",
                                            data: { "name": " World!" },
                                            contentType: 'application/x-www-form-urlencoded',
                                            dataType: "json",
                                            headers:
                                            {
                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                            },
                                            success: function(message) {
                                                document.getElementById("cash").innerHTML = message;
                                                $.ajax({
                                                    type: "POST",
                                                    url: "/Index?handler=GetInvestment",
                                                    data: { "name": " World!" },
                                                    contentType: 'application/x-www-form-urlencoded',
                                                    dataType: "json",
                                                    headers:
                                                    {
                                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                    },
                                                    success: function(message) {
                                                        document.getElementById("investment").innerHTML = message;
                                                        $.ajax({
                                                            type: "POST",
                                                            url: "/Index?handler=GetCurrentTickerPrice",
                                                            data: { "name": " World!" },
                                                            contentType: 'application/x-www-form-urlencoded',
                                                            dataType: "json",
                                                            headers:
                                                            {
                                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                            },
                                                            success: function(message) {
                                                                document.getElementById("tickerprice").innerHTML = message;
                                                            }
                                                        });
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            }
        });

        $("#invokeHold").click(function() {
            var tickerChosen = $('#tickerVariable').val();

            $.ajax({
                type: "POST",
                url: "/Index?handler=HoldStocks",
                data: { "amountSold": "Hello" },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(message) {
                    // Do the logic here instead of in the .cs, return the ticker pricec though, and have global variables for Cash, Ticker, etc.. and actually return the name instead of the public variable in the .cs file
                    document.getElementById("lastaction").innerHTML = message;
                    document.getElementById("choosescreen").style.display = "block";
                    document.getElementById("sellscreen").style.display = "none";
                    document.getElementById("buyscreen").style.display = "none";

                    if (message == "COMPLETE") {
                        document.getElementById("dataholder").style.display = "none";
                        document.getElementById("final").style.display = "block";
                        document.getElementById("buttondisplay").style.display = "none";
                        document.getElementById("startdisplay").style.display = "none";

                        $.ajax({
                            type: "POST",
                            url: "/Index?handler=GetStartDate",
                            data: { "name": " World!" },
                            contentType: 'application/x-www-form-urlencoded',
                            dataType: "json",
                            headers:
                            {
                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                            },
                            success: function(message) {
                                document.getElementById("startdate").innerHTML = message;
                            }
                        });
                    }
                }
            });

            setTimeout(wait(), 2000);
            // or put a timer here

            function wait() {
                // Make all this a function you can call
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=GetDate",
                    data: { "name": " World!" },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function(message) {
                        document.getElementById("date").innerHTML = message;
                        $.ajax({
                            type: "POST",
                            url: "/Index?handler=GetTicker",
                            data: { "name": tickerChosen },
                            contentType: 'application/x-www-form-urlencoded',
                            dataType: "json",
                            headers:
                            {
                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                            },
                            success: function(message) {
                                document.getElementById("ticker").innerHTML = message;
                                $.ajax({
                                    type: "POST",
                                    url: "/Index?handler=GetStocks",
                                    data: { "name": " World!" },
                                    contentType: 'application/x-www-form-urlencoded',
                                    dataType: "json",
                                    headers:
                                    {
                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                    },
                                    success: function(message) {
                                        document.getElementById("stocks").innerHTML = message;
                                        $.ajax({
                                            type: "POST",
                                            url: "/Index?handler=GetCash",
                                            data: { "name": " World!" },
                                            contentType: 'application/x-www-form-urlencoded',
                                            dataType: "json",
                                            headers:
                                            {
                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                            },
                                            success: function(message) {
                                                document.getElementById("cash").innerHTML = message;
                                                $.ajax({
                                                    type: "POST",
                                                    url: "/Index?handler=GetInvestment",
                                                    data: { "name": " World!" },
                                                    contentType: 'application/x-www-form-urlencoded',
                                                    dataType: "json",
                                                    headers:
                                                    {
                                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                    },
                                                    success: function(message) {
                                                        document.getElementById("investment").innerHTML = message;
                                                        $.ajax({
                                                            type: "POST",
                                                            url: "/Index?handler=GetCurrentTickerPrice",
                                                            data: { "name": " World!" },
                                                            contentType: 'application/x-www-form-urlencoded',
                                                            dataType: "json",
                                                            headers:
                                                            {
                                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                            },
                                                            success: function(message) {
                                                                document.getElementById("tickerprice").innerHTML = message;
                                                            }
                                                        });
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            }
        });

        $("#invokeQuit").click(function() {
            var tickerChosen = $('#tickerVariable').val();

            $.ajax({
                type: "POST",
                url: "/Index?handler=QuitGame",
                data: { "amountSold": "Hello" },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(message) {
                    // Do the logic here instead of in the .cs, return the ticker pricec though, and have global variables for Cash, Ticker, etc.. and actually return the name instead of the public variable in the .cs file
                    document.getElementById("finalamount").innerHTML = message;
                    document.getElementById("choosescreen").style.display = "none";
                    document.getElementById("sellscreen").style.display = "none";
                    document.getElementById("buyscreen").style.display = "none";
                    document.getElementById("dataholder").style.display = "none";
                    document.getElementById("buttondisplay").style.display = "none";
                    document.getElementById("startdisplay").style.display = "none";
                    document.getElementById("final").style.display = "block";
                }
            });

            setTimeout(wait(), 2000);
            // or put a timer here

            function wait() {
                // Make all this a function you can call
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=GetDate",
                    data: { "name": " World!" },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function(message) {
                        document.getElementById("date").innerHTML = message;
                        $.ajax({
                            type: "POST",
                            url: "/Index?handler=GetTicker",
                            data: { "name": tickerChosen },
                            contentType: 'application/x-www-form-urlencoded',
                            dataType: "json",
                            headers:
                            {
                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                            },
                            success: function(message) {
                                document.getElementById("ticker").innerHTML = message;
                                $.ajax({
                                    type: "POST",
                                    url: "/Index?handler=GetStocks",
                                    data: { "name": " World!" },
                                    contentType: 'application/x-www-form-urlencoded',
                                    dataType: "json",
                                    headers:
                                    {
                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                    },
                                    success: function(message) {
                                        document.getElementById("stocks").innerHTML = message;
                                        $.ajax({
                                            type: "POST",
                                            url: "/Index?handler=GetCash",
                                            data: { "name": " World!" },
                                            contentType: 'application/x-www-form-urlencoded',
                                            dataType: "json",
                                            headers:
                                            {
                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                            },
                                            success: function(message) {
                                                document.getElementById("cash").innerHTML = message;
                                                $.ajax({
                                                    type: "POST",
                                                    url: "/Index?handler=GetInvestment",
                                                    data: { "name": " World!" },
                                                    contentType: 'application/x-www-form-urlencoded',
                                                    dataType: "json",
                                                    headers:
                                                    {
                                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                    },
                                                    success: function(message) {
                                                        document.getElementById("investment").innerHTML = message;
                                                        $.ajax({
                                                            type: "POST",
                                                            url: "/Index?handler=GetCurrentTickerPrice",
                                                            data: { "name": " World!" },
                                                            contentType: 'application/x-www-form-urlencoded',
                                                            dataType: "json",
                                                            headers:
                                                            {
                                                                "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                            },
                                                            success: function(message) {
                                                                document.getElementById("tickerprice").innerHTML = message;

                                                                $.ajax({
                                                                    type: "POST",
                                                                    url: "/Index?handler=GetStartDate",
                                                                    data: { "name": " World!" },
                                                                    contentType: 'application/x-www-form-urlencoded',
                                                                    dataType: "json",
                                                                    headers:
                                                                    {
                                                                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                                                                    },
                                                                    success: function(message) {
                                                                        document.getElementById("startdate").innerHTML = message;
                                                                    }
                                                                });

                                                            }
                                                        });
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            }
        });

        $("#goBuy").click(function() {
            document.getElementById("choosescreen").style.display = "none";
            document.getElementById("buyscreen").style.display = "block";
        });

        $("#goSell").click(function() {
            document.getElementById("choosescreen").style.display = "none";
            document.getElementById("sellscreen").style.display = "block";
        });

                                // Do a on change where if last action is COMPLETE then you lock the buttons and show the final investment
    </script>
}